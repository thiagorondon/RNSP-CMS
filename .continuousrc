#!/bin/bash  -ex

# Parametro que pode ser útil em alguns cenários.
sysctl vm.overcommit_memory=1

# Instalando dependencias da distribuição
export DEBIAN_FRONTEND=noninteractive
#apt-get -y install mysql-server mysql-client libmysqlclient15-dev
apt-get -y install build-essential

# local::lib
wget http://search.cpan.org/CPAN/authors/id/A/AP/APEIRON/local-lib-1.008004.tar.gz
tar vxfzp local-lib-1.008004.tar.gz
cd local-lib-1.008004
perl Makefile.PL --bootstrap
make test && make install
echo 'eval $(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)' >>~/.bashrc
. ~/.bashrc
cd ../

# cpanminus
curl -L http://cpanmin.us | perl - App::cpanminus

# Dependencias do aplicativo
cpanm -v inc::Module::Install
cpanm -v --installdeps .

# Executando testes
perl Makefile.PL
make test

